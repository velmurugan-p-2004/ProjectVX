<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Dashboard - VishnoRex</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/salary_management.css') }}">
    <style>
        /* OVERRIDE: Fix sidebar positioning for staff dashboard - Higher specificity */
        .container-fluid {
            padding: 0 !important;
            margin: 0 !important;
        }
        
        .row {
            margin: 0;
            height: fit-content !important;
            min-height: unset !important;
            display: flex;
            flex-wrap: nowrap;
        }
        
        /* FIXED SIDEBAR - Override external CSS */
        nav.enhanced-sidebar,
        .enhanced-sidebar {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 250px !important;
            height: 100vh !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            z-index: 1000 !important;
            display: block !important;
            transform: translateX(0) !important;
            background: linear-gradient(180deg, #2c3e50 0%, #34495e 100%) !important;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1) !important;
        }
        
        /* MAIN CONTENT - Match sidebar width exactly */
        main.salary-main-content,
        .salary-main-content {
            margin-left: 250px !important;
            width: calc(100% - 250px) !important;
            min-height: 100vh;
            padding: 2rem 1rem !important;
            overflow-x: hidden;
        }
        
        /* Remove Bootstrap default spacing */
        .col-md-2, .col-md-10 {
            padding-left: 0 !important;
            padding-right: 0 !important;
        }
        
        /* MOBILE RESPONSIVE - Override external CSS */
        @media (max-width: 768px) {
            nav.enhanced-sidebar,
            .enhanced-sidebar {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 280px !important;
                height: 100vh !important;
                overflow-y: auto !important;
                transform: translateX(-100%) !important;
                transition: transform 0.3s ease !important;
                z-index: 1050 !important;
                display: block !important;
            }
            
            nav.enhanced-sidebar.show,
            .enhanced-sidebar.show {
                transform: translateX(0) !important;
            }
            
            main.salary-main-content,
            .salary-main-content {
                margin-left: 0 !important;
                width: 100% !important;
                padding: 1rem 0.5rem !important;
                padding-top: 4rem !important;
            }
            
            .sidebar-toggle {
                display: block !important;
                position: fixed !important;
                top: 1rem !important;
                left: 1rem !important;
                z-index: 1100 !important;
                background: #007bff !important;
                color: white !important;
                border: none !important;
                border-radius: 0.375rem !important;
                padding: 0.75rem !important;
                font-size: 1.25rem !important;
            }
        }
        
        /* DESKTOP - Ensure sidebar is always visible and fixed */
        @media (min-width: 769px) {
            nav.enhanced-sidebar,
            .enhanced-sidebar {
                position: fixed !important;
                display: block !important;
                transform: translateX(0) !important;
                width: 250px !important;
                height: 100vh !important;
            }
            
            .sidebar-toggle {
                display: none !important;
            }
        }
        
        /* Ensure proper stacking and prevent layout shifts */
        body {
            overflow-x: hidden;
        }
        
        /* Force sidebar content to be properly positioned */
        .enhanced-sidebar .sidebar-header,
        .enhanced-sidebar .sidebar-content,
        .enhanced-sidebar .sidebar-footer {
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body>
    <!-- Mobile Sidebar Toggle -->
    <button type="button" class="sidebar-toggle d-md-none" id="sidebarToggle" title="Toggle sidebar menu" aria-expanded="false" aria-controls="enhanced-sidebar">
        <i class="bi bi-list"></i>
    </button>

    <div class="container-fluid">
        <div class="row">
            <!-- Enhanced Sidebar -->
            <nav class="col-md-2 enhanced-sidebar" id="enhanced-sidebar">
                <div class="sidebar-header">
                    <div class="brand-logo">
                        <div class="logo-icon">
                            <i class="bi bi-person-workspace"></i>
                        </div>
                        <div class="brand-text">
                            <h6 class="brand-title">VishnoRex</h6>
                            <small class="brand-subtitle">Staff Panel</small>
                        </div>
                    </div>
                </div>

                <div class="sidebar-content">
                    <!-- User Profile Section -->
                    <div class="user-profile">
                        <div class="user-avatar">
                            <i class="bi bi-person-circle"></i>
                        </div>
                        <div class="user-info">
                            <div class="user-name">{{ session.get('full_name', 'Staff User') }}</div>
                            <div class="user-role">Staff Member</div>
                        </div>
                    </div>

                    <!-- Navigation Menu -->
                    <div class="nav-section">
                        <div class="nav-section-title">
                            <i class="bi bi-grid-3x3-gap"></i>
                            <span>Main Menu</span>
                        </div>
                        <ul class="nav-menu">
                            <li class="nav-item">
                                <a class="nav-link active" href="#">
                                    <div class="nav-icon">
                                        <i class="bi bi-house-door"></i>
                                    </div>
                                    <span class="nav-text">Dashboard</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('staff_profile_page') }}">
                                    <div class="nav-icon">
                                        <i class="bi bi-person"></i>
                                    </div>
                                    <span class="nav-text">My Profile</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Applications Section -->
                    <div class="nav-section">
                        <div class="nav-section-title">
                            <i class="bi bi-file-earmark-text"></i>
                            <span>Applications</span>
                        </div>
                        <ul class="nav-menu">
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#applyLeaveModal">
                                    <div class="nav-icon">
                                        <i class="bi bi-calendar-plus"></i>
                                    </div>
                                    <span class="nav-text">Apply Leave</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#applyOnDutyModal">
                                    <div class="nav-icon">
                                        <i class="bi bi-briefcase"></i>
                                    </div>
                                    <span class="nav-text">Apply On Duty</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#applyPermissionModal">
                                    <div class="nav-icon">
                                        <i class="bi bi-clock"></i>
                                    </div>
                                    <span class="nav-text">Apply Permission</span>
                                    <div class="nav-indicator"></div>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Sidebar Footer -->
                <div class="sidebar-footer">
                    <div class="footer-stats">
                        <div class="stat-item">
                            <i class="bi bi-calendar-day"></i>
                            <span id="currentDate">-</span>
                        </div>
                    </div>
                    <button type="button" class="logout-btn" onclick="logout()" title="Logout">
                        <i class="bi bi-box-arrow-right"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-10 ms-sm-auto px-md-4 salary-main-content">
                <!-- Enhanced Header -->
                <div class="salary-header">
                    <div class="header-content">
                        <div class="header-title">
                            <div class="title-icon">
                                <i class="bi bi-speedometer2"></i>
                            </div>
                            <div class="title-text">
                                <h1 class="main-title">Staff Dashboard</h1>
                                <p class="subtitle">Welcome back, {{ session.get('full_name', 'Staff User') }}! Track your attendance and manage applications</p>
                            </div>
                        </div>
                        <div class="header-actions">
                            <button type="button" class="btn btn-outline-primary" id="refreshDataBtn" title="Refresh data">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                <!-- </div>
                            <i class="bi bi-person me-2"></i>My Profile</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('staff_change_password') }}">
                            <i class="bi bi-key me-2"></i>Change Password</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}">
                            <i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                    </ul>
                </li> -->
                <!-- CSRF Token for AJAX requests -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                <!-- Today's Attendance Card -->
                <div class="salary-filters-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="bi bi-calendar-check"></i>
                        </div>
                        <div class="header-content">
                            <h5 class="card-title">Today's Attendance</h5>
                            <p class="card-subtitle">{{ today.strftime('%d %b %Y') }} - Track your daily attendance</p>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="filters-grid">
                            <div class="filter-group">
                                <label class="form-label">
                                    <i class="bi bi-clock"></i> Check-in Time
                                </label>
                                <div class="attendance-time-display">
                                    <span class="time-value text-success" id="timeIn">--:--:--</span>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">
                                    <i class="bi bi-clock-history"></i> Check-out Time
                                </label>
                                <div class="attendance-time-display">
                                    <span class="time-value text-info" id="timeOut">--:--:--</span>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">
                                    <i class="bi bi-check-circle"></i> Status
                                </label>
                                <div class="attendance-status-display">
                                    <span class="badge bg-secondary" id="currentStatus">Not Marked</span>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">
                                    <i class="bi bi-stopwatch"></i> Total Hours
                                </label>
                                <div class="attendance-time-display">
                                    <span class="time-value text-primary" id="totalHours">--:--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Leave Applications -->
                <div class="salary-results-card">
                    <div class="card-header">
                        <div class="header-icon">
                            <i class="bi bi-calendar-x"></i>
                        </div>
                        <div class="header-content">
                            <h5 class="card-title">My Leave Applications</h5>
                            <p class="card-subtitle">Track your leave requests and their status</p>
                        </div>
                        <div class="header-actions">
                            <div class="results-stats">
                                <div class="stat-item">
                                    <i class="bi bi-file-earmark-text"></i>
                                    <span class="stat-value">{{ leaves|length }}</span>
                                    <span>Applications</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        {% if leaves %}
                        <div class="table-responsive">
                            <table class="table salary-results-table">
                                <thead>
                                    <tr>
                                        <th>Leave Type</th>
                                        <th>Duration</th>
                                        <th>Reason</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for leave in leaves %}
                                    <tr>
                                        <td>
                                            <span class="badge bg-info">{{ leave.leave_type }}</span>
                                        </td>
                                        <td>
                                            <div>
                                                <small class="d-block"><i class="bi bi-calendar-event"></i> {{ leave.start_date }}</small>
                                                <small class="d-block"><i class="bi bi-calendar-event"></i> {{ leave.end_date }}</small>
                                            </div>
                                        </td>
                                        <td>{{ leave.reason }}</td>
                                        <td>
                                            {% if leave.status == 'approved' %}
                                                <span class="earnings-badge">Approved</span>
                                            {% elif leave.status == 'rejected' %}
                                                <span class="badge bg-danger">Rejected</span>
                                            {% else %}
                                                <span class="deductions-badge">Pending</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="bi bi-calendar-x"></i>
                            </div>
                            <h6 class="empty-title">No Leave Applications</h6>
                            <p class="empty-text">You haven't applied for any leave yet. Click "Apply Leave" to submit your first request.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

            <!-- My On Duty Applications -->
            <div class="salary-results-card mb-4">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="bi bi-briefcase"></i>
                    </div>
                    <div class="header-content">
                        <h5 class="card-title">My On Duty Applications</h5>
                        <p class="card-subtitle">Your on-duty request history and status</p>
                    </div>
                    <div class="header-actions">
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#applyOnDutyModal">
                            <i class="bi bi-plus"></i> Apply On Duty
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    {% if on_duty_applications %}
                    <div class="table-responsive">
                        <table class="table salary-results-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>From</th>
                                    <th>To</th>
                                    <th>Location</th>
                                    <th>Purpose</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for duty in on_duty_applications %}
                                <tr>
                                    <td><span class="badge bg-success">{{ duty.duty_type }}</span></td>
                                    <td>{{ duty.start_date|dateformat if duty.start_date else '-' }}</td>
                                    <td>{{ duty.end_date|dateformat if duty.end_date else '-' }}</td>
                                    <td>{{ duty.location or '-' }}</td>
                                    <td>{{ duty.purpose[:30] }}{% if duty.purpose|length > 30 %}...{% endif %}</td>
                                    <td>
                                        {% if duty.status == 'approved' %}
                                            <span class="earnings-badge">Approved</span>
                                        {% elif duty.status == 'rejected' %}
                                            <span class="badge bg-danger">Rejected</span>
                                        {% else %}
                                            <span class="deductions-badge">Pending</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="bi bi-briefcase"></i>
                        </div>
                        <h6 class="empty-title">No On Duty Applications</h6>
                        <p class="empty-text">You haven't applied for any on-duty yet. Click "Apply On Duty" to submit your first request.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- My Permission Applications -->
            <div class="salary-results-card mb-4">
                <div class="card-header">
                    <div class="header-icon">
                        <i class="bi bi-clock-history"></i>
                    </div>
                    <div class="header-content">
                        <h5 class="card-title">My Permission Applications</h5>
                        <p class="card-subtitle">Your permission request history and status</p>
                    </div>
                    <div class="header-actions">
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#applyPermissionModal">
                            <i class="bi bi-plus"></i> Apply Permission
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    {% if permission_applications %}
                    <div class="table-responsive">
                        <table class="table salary-results-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Date</th>
                                    <th>Time</th>
                                    <th>Duration</th>
                                    <th>Reason</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for permission in permission_applications %}
                                <tr>
                                    <td><span class="badge bg-warning">{{ permission.permission_type }}</span></td>
                                    <td>{{ permission.permission_date|dateformat if permission.permission_date else '-' }}</td>
                                    <td>{{ permission.start_time|timeformat }} - {{ permission.end_time|timeformat }}</td>
                                    <td>{{ "%.1f"|format(permission.duration_hours) }} hrs</td>
                                    <td>{{ permission.reason[:30] }}{% if permission.reason|length > 30 %}...{% endif %}</td>
                                    <td>
                                        {% if permission.status == 'approved' %}
                                            <span class="earnings-badge">Approved</span>
                                        {% elif permission.status == 'rejected' %}
                                            <span class="badge bg-danger">Rejected</span>
                                        {% else %}
                                            <span class="deductions-badge">Pending</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="bi bi-clock-history"></i>
                        </div>
                        <h6 class="empty-title">No Permission Applications</h6>
                        <p class="empty-text">You haven't applied for any permission yet. Click "Apply Permission" to submit your first request.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

        </div>

        <!-- Right Column -->
        <!-- <div class="col-md-4">


            Today's Status Card
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5><i class="bi bi-calendar-day"></i> Today's Status</h5>
                </div>
                <div class="card-body text-center">
                    <div id="todayStatusDisplay">
                        <div class="mb-3">
                            <h3 id="todayStatusText" class="text-muted">Loading...</h3>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Check-in</small>
                                    <div id="todayCheckIn" class="fw-bold">--:--</div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="border rounded p-2">
                                    <small class="text-muted">Check-out</small>
                                    <div id="todayCheckOut" class="fw-bold">--:--</div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <a href="{{ url_for('staff_profile_page') }}" class="btn btn-outline-info btn-sm">
                                <i class="bi bi-person"></i> View Full Profile
                            </a>
                        </div>
                    </div>
                </div>
            </div> -->

            <!-- Quick Actions -->
            <!-- <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5>Quick Actions</h5>
                </div>
                <div class="card-body">
                    <button type="button" class="btn btn-outline-primary w-100 mb-2" data-bs-toggle="modal" data-bs-target="#applyLeaveModal">
                        <i class="bi bi-calendar-plus"></i> Apply Leave
                    </button>
                    <button type="button" class="btn btn-outline-success w-100 mb-2" data-bs-toggle="modal" data-bs-target="#applyOnDutyModal">
                        <i class="bi bi-briefcase"></i> Apply On Duty
                    </button>
                    <button type="button" class="btn btn-outline-warning w-100 mb-2" data-bs-toggle="modal" data-bs-target="#applyPermissionModal">
                        <i class="bi bi-clock"></i> Apply Permission
                    </button>
                    <button type="button" class="btn btn-outline-secondary w-100" id="downloadReportBtn">
                        <i class="bi bi-file-earmark-text"></i> Download Report
                    </button>
                </div>
            </div> -->

            <!-- Attendance Summary -->
            <!-- <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5>Attendance Summary ({{ today.strftime('%B %Y') }})</h5>
                </div>
                <div class="card-body">
                    <canvas id="attendanceChart" width="100%" height="200"></canvas>
                    <div class="mt-3">
                        <p><span class="badge bg-success me-2">&nbsp;</span> Present: <span id="presentDays">0</span> days</p>
                        <p><span class="badge bg-danger me-2">&nbsp;</span> Absent: <span id="absentDays">0</span> days</p>
                        <p><span class="badge bg-warning me-2">&nbsp;</span> Late: <span id="lateDays">0</span> days</p>
                        <p><span class="badge me-2" style="background-color: #fd7e14;">&nbsp;</span> Left Soon: <span id="leftSoonDays">0</span> days</p>
                        <p><span class="badge bg-info me-2">&nbsp;</span> Leave: <span id="leaveDays">0</span> days</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> -->

<!-- Apply Leave Modal -->
<div class="modal fade" id="applyLeaveModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Apply for Leave</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="leaveForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="mb-3">
                        <label for="leaveType" class="form-label">Leave Type</label>
                        <select class="form-select" id="leaveType" required>
                            <option value="" selected disabled>Select leave type</option>
                            <option value="CL">Casual Leave (CL)</option>
                            <option value="SL">Sick Leave (SL)</option>
                            <option value="EL">Earned Leave (EL)</option>
                            <option value="ML">Maternity Leave (ML)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="startDate" class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="startDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="endDate" class="form-label">End Date</label>
                        <input type="date" class="form-control" id="endDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="leaveReason" class="form-label">Reason</label>
                        <textarea class="form-control" id="leaveReason" rows="3" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="submitLeave">Submit</button>
            </div>
        </div>
    </div>
</div>

<!-- Apply On Duty Modal -->
<div class="modal fade" id="applyOnDutyModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">Apply for On Duty</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="onDutyForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dutyType" class="form-label">Duty Type</label>
                                <select class="form-select" id="dutyType" name="duty_type" required>
                                    <option value="" selected disabled>Select duty type</option>
                                    <option value="Official Work">Official Work</option>
                                    <option value="Training">Training</option>
                                    <option value="Meeting">Meeting</option>
                                    <option value="Conference">Conference</option>
                                    <option value="Field Work">Field Work</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dutyLocation" class="form-label">Location</label>
                                <input type="text" class="form-control" id="dutyLocation" name="location" placeholder="Enter location">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dutyStartDate" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="dutyStartDate" name="start_date" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dutyEndDate" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="dutyEndDate" name="end_date" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dutyStartTime" class="form-label">Start Time (Optional)</label>
                                <input type="time" class="form-control" id="dutyStartTime" name="start_time">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="dutyEndTime" class="form-label">End Time (Optional)</label>
                                <input type="time" class="form-control" id="dutyEndTime" name="end_time">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="dutyPurpose" class="form-label">Purpose</label>
                        <textarea class="form-control" id="dutyPurpose" name="purpose" rows="2" required placeholder="Brief description of the duty purpose"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="dutyReason" class="form-label">Additional Details (Optional)</label>
                        <textarea class="form-control" id="dutyReason" name="reason" rows="2" placeholder="Any additional information"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="submitOnDuty">Submit Application</button>
            </div>
        </div>
    </div>
</div>

<!-- Apply Permission Modal -->
<div class="modal fade" id="applyPermissionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">Apply for Permission</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="permissionForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="mb-3">
                        <label for="permissionType" class="form-label">Permission Type</label>
                        <select class="form-select" id="permissionType" name="permission_type" required>
                            <option value="" selected disabled>Select permission type</option>
                            <option value="Personal Work">Personal Work</option>
                            <option value="Medical">Medical</option>
                            <option value="Emergency">Emergency</option>
                            <option value="Family Function">Family Function</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="permissionDate" class="form-label">Date</label>
                        <input type="date" class="form-control" id="permissionDate" name="permission_date" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="permissionStartTime" class="form-label">Start Time</label>
                                <input type="time" class="form-control" id="permissionStartTime" name="start_time" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="permissionEndTime" class="form-label">End Time</label>
                                <input type="time" class="form-control" id="permissionEndTime" name="end_time" required>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="permissionReason" class="form-label">Reason</label>
                        <textarea class="form-control" id="permissionReason" name="reason" rows="3" required placeholder="Please provide detailed reason for permission"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-warning" id="submitPermission">Submit Application</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Set current staff ID for JavaScript access
    window.currentStaffId = '{{ staff_info.staff_id if staff_info else "" }}';
    
    // Mobile sidebar toggle functionality
    document.addEventListener('DOMContentLoaded', function() {
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('enhanced-sidebar');
        
        // Show sidebar on desktop by default
        function updateSidebarVisibility() {
            if (window.innerWidth > 768) {
                sidebar.style.display = 'block';
                sidebar.classList.remove('show');
            } else {
                sidebar.style.display = 'block'; // Make sure it's not hidden by inline style
            }
        }
        
        // Initial setup
        updateSidebarVisibility();
        
        if (sidebarToggle && sidebar) {
            sidebarToggle.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Staff Dashboard - Toggle button clicked');
                
                sidebar.classList.toggle('show');
                
                // Update aria-expanded for accessibility
                const expanded = sidebar.classList.contains('show');
                sidebarToggle.setAttribute('aria-expanded', expanded);
            });
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(event) {
                if (window.innerWidth <= 768) { // Only on mobile
                    if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
                        sidebar.classList.remove('show');
                        sidebarToggle.setAttribute('aria-expanded', 'false');
                    }
                }
            });
            
            // Handle window resize
            window.addEventListener('resize', updateSidebarVisibility);
        }
    });
</script>
<script src="{{ url_for('static', filename='js/staff_dashboard.js') }}"></script>
</body>
</html>